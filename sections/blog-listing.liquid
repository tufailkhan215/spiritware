{% comment %}
  Blog listing section for blog template (blog.json).
  Renders "All Articles" grid with category, title, excerpt, author, read time.
{% endcomment %}

{% schema %}
{
  "name": "Blog listing",
  "tag": "section",
  "class": "blog-listing-section",
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog to display",
      "info": "Choose which blog's posts to show. Leave blank on a blog page to show the current blog (e.g. News)."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "All Articles"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "label": "Posts per page",
      "min": 3,
      "max": 30,
      "step": 1,
      "default": 12
    }
  ],
  "presets": [
    {
      "name": "Blog listing",
      "settings": {
        "heading": "All Articles",
        "posts_per_page": 12
      }
    }
  ]
}
{% endschema %}

{%- assign page_size = section.settings.posts_per_page | default: 12 -%}
{%- assign section_heading = section.settings.heading | default: 'All Articles' -%}
{%- if section.settings.blog != blank -%}
  {%- assign blog_handle = section.settings.blog -%}
{%- elsif blog != blank -%}
  {%- assign blog_handle = blog.handle -%}
{%- else -%}
  {%- assign blog_handle = '' -%}
{%- endif -%}
{%- if blog_handle != '' -%}
  {%- assign selected_blog = blogs[blog_handle] -%}
  {%- assign blog_articles = selected_blog.articles -%}
{%- else -%}
  {%- assign selected_blog = nil -%}
  {%- assign blog_articles = nil -%}
{%- endif -%}

<section class="blog-listing-section pb-24 px-6 lg:px-12" aria-label="{{ section_heading }}">
  <div class="blog-listing-section__inner max-w-7xl mx-auto">
    <h2 class="blog-listing-section__title font-serif text-2xl text-[#1A1A1A] mb-12">{{ section_heading }}</h2>

    {% if blog_articles == blank %}
      <p class="blog-listing-section__empty text-[#1A1A1A]/60">Select a blog in the section settings, or assign the "blog" template to a blog page.</p>
    {% elsif blog_articles.size == 0 %}
      <p class="blog-listing-section__empty text-[#1A1A1A]/60">No articles in this blog yet.</p>
    {% else %}
        <div class="blog-listing-section__grid grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {% for article in blog_articles limit: page_size %}
            <article class="blog-listing-card">
              <a href="{{ article.url }}" class="blog-listing-card__link group block" data-discover="true">
                <div class="blog-listing-card__image-wrap relative overflow-hidden mb-5 bg-[#EDE8E0]">
                  <div class="blog-listing-card__aspect aspect-[3/2]">
                    {% if article.image != blank %}
                      <img
                        alt="{{ article.image.alt | default: article.title | escape }}"
                        class="blog-listing-card__img w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                        src="{{ article.image | image_url: width: 800 }}"
                        width="800"
                        height="533"
                        loading="lazy"
                      >
                    {% else %}
                      <div class="blog-listing-card__placeholder w-full h-full flex items-center justify-center text-[#1A1A1A]/40">
                        {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                      </div>
                    {% endif %}
                  </div>
                </div>
                {% if article.tags.size > 0 %}
                  <span class="blog-listing-card__category font-sans text-xs tracking-[0.2em] uppercase text-[#C4A77D] mb-2 block">{{ article.tags.first }}</span>
                {% endif %}
                <h3 class="blog-listing-card__title font-serif text-xl text-[#1A1A1A] mb-3 group-hover:text-[#C4A77D] transition-colors">{{ article.title }}</h3>
                <p class="blog-listing-card__excerpt font-sans text-sm text-[#1A1A1A]/60 mb-4 line-clamp-2">
                  {% if article.excerpt != blank %}
                    {{ article.excerpt | strip_html | truncatewords: 25 }}
                  {% else %}
                    {{ article.content | strip_html | truncatewords: 25 }}
                  {% endif %}
                </p>
                <div class="blog-listing-card__meta flex items-center gap-3 text-xs text-[#1A1A1A]/50">
                  <span class="font-sans">{{ article.author | default: 'Sacred Rebel Team' }}</span>
                  <span aria-hidden="true">â€¢</span>
                  <span class="font-sans">
                    {% assign words = article.content | strip_html | split: ' ' | size %}
                    {% assign mins = words | divided_by: 180 %}
                    {% if mins < 1 %}1 min read{% else %}{{ mins }} min read{% endif %}
                  </span>
                </div>
              </a>
            </article>
          {% endfor %}
        </div>

        {% if blog_articles.size > page_size %}
          <nav class="blog-listing-section__pagination mt-12 flex justify-center items-center gap-4" aria-label="Blog pagination">
            <a href="{{ selected_blog.url }}" class="blog-listing-section__pagination-link">View all {{ selected_blog.articles_count }} articles</a>
          </nav>
        {% endif %}
    {% endif %}
  </div>
</section>
