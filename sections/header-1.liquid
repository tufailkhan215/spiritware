{% comment %}
  Header 1 (Sacred Rebel) — Fixed, transparent-to-solid on scroll.
  Per SACRED_REBEL_HOMEPAGE_PROMPT.md §2. Theme setting: header_style = 'header_1'.
{% endcomment %}

{%- assign header_bg = section.settings.background_color | default: 'transparent' -%}
{%- assign header_bg_scrolled = section.settings.background_color_scrolled | default: 'rgba(250, 247, 242, 0.95)' -%}
<header class="header-1" id="header-1" role="banner" data-scrolled-bg="{{ section.settings.header_scrolled_bg }}" style="--header-1-bg: {{ header_bg }}; --header-1-bg-scrolled: {{ header_bg_scrolled }};">
  <div class="header-1__container">
    <div class="header-1__inner">
      <a href="{{ routes.root_url }}" class="header-1__logo">
        <span class="header-1__logo-text">{{ section.settings.logo_text | default: shop.name }}</span>
      </a>

      <nav class="header-1__nav" aria-label="Main">
        {%- if section.settings.menu != blank -%}
          {%- for link in linklists[section.settings.menu].links -%}
            {%- assign link_handle = link.title | handleize -%}
            {%- assign mega_block = nil -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'mega_menu' and block.settings.trigger_handle != blank -%}
                {%- assign trigger_handle = block.settings.trigger_handle | strip | handleize -%}
                {%- if link_handle == trigger_handle -%}
                  {%- assign mega_block = block -%}
                  {%- break -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
            {%- assign has_dropdown = false -%}
            {%- if mega_block != nil or link.links != empty -%}
              {%- assign has_dropdown = true -%}
            {%- endif -%}
            {%- assign is_mega = false -%}
            {%- if mega_block != nil -%}
              {%- assign is_mega = true -%}
            {%- endif -%}
            <div class="header-1__nav-item {% if has_dropdown %}header-1__nav-item--has-dropdown{% endif %} {% if is_mega %}header-1__nav-item--mega{% endif %}" {% if has_dropdown %}aria-haspopup="true" aria-expanded="false" data-header-dropdown{% endif %}>
              <a href="{{ link.url }}" class="header-1__nav-link {% if link.active %}header-1__nav-link--active{% endif %}" {% if has_dropdown %}aria-expanded="false" aria-controls="header-1-dropdown-{{ section.id }}-{{ forloop.index }}" id="header-1-trigger-{{ section.id }}-{{ forloop.index }}"{% endif %}>
                {{ link.title | escape }}
                {%- if has_dropdown -%}
                  <span class="header-1__nav-chevron" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                  </span>
                {%- endif -%}
              </a>
              {%- if is_mega and mega_block != nil -%}
                {%- assign col_count_raw = mega_block.settings.columns | default: 2 -%}
                {%- assign col_count = col_count_raw | plus: 0 -%}
                {%- if col_count <= 0 -%}
                  {%- assign col_count = 2 -%}
                {%- endif -%}
                <div class="header-1__mega" id="header-1-dropdown-{{ section.id }}-{{ forloop.index }}" role="menu" aria-label="{{ link.title | escape }}" style="--mega-columns: {{ col_count }};" {{ mega_block.shopify_attributes }}>
                  <div class="header-1__mega-inner">
                    {%- assign cols_done = 0 -%}
                    {%- for i in (1..5) -%}
                      {%- if cols_done >= col_count -%}
                        {%- break -%}
                      {%- endif -%}
                      {%- assign col_heading = '' -%}
                      {%- assign col_menu = '' -%}
                      {%- assign col_image = nil -%}
                      {%- if i == 1 -%}
                        {%- assign col_heading = mega_block.settings.column_1_heading -%}
                        {%- assign col_menu = mega_block.settings.column_1_menu -%}
                        {%- assign col_image = mega_block.settings.column_1_image -%}
                      {%- elsif i == 2 -%}
                        {%- assign col_heading = mega_block.settings.column_2_heading -%}
                        {%- assign col_menu = mega_block.settings.column_2_menu -%}
                        {%- assign col_image = mega_block.settings.column_2_image -%}
                      {%- elsif i == 3 -%}
                        {%- assign col_heading = mega_block.settings.column_3_heading -%}
                        {%- assign col_menu = mega_block.settings.column_3_menu -%}
                        {%- assign col_image = mega_block.settings.column_3_image -%}
                      {%- elsif i == 4 -%}
                        {%- assign col_heading = mega_block.settings.column_4_heading -%}
                        {%- assign col_menu = mega_block.settings.column_4_menu -%}
                        {%- assign col_image = mega_block.settings.column_4_image -%}
                      {%- elsif i == 5 -%}
                        {%- assign col_heading = mega_block.settings.column_5_heading -%}
                        {%- assign col_menu = mega_block.settings.column_5_menu -%}
                        {%- assign col_image = mega_block.settings.column_5_image -%}
                      {%- endif -%}
                      {%- assign col_has_content = false -%}
                      {%- if col_heading != blank or col_menu != blank -%}
                        {%- assign col_has_content = true -%}
                      {%- endif -%}
                      {%- if col_menu != blank and linklists[col_menu].links.size > 0 -%}
                        {%- assign col_has_content = true -%}
                      {%- endif -%}
                      {%- if col_has_content or col_image != blank -%}
                        {%- assign cols_done = cols_done | plus: 1 -%}
                        <div class="header-1__mega-column">
                          {%- if col_image != blank -%}
                            <div class="header-1__mega-column-image">
                              <img src="{{ col_image | image_url: width: 400 }}" alt="{{ col_heading | default: '' | escape }}" width="400" height="300" loading="lazy">
                            </div>
                          {%- endif -%}
                          {%- if col_heading != blank -%}
                            <p class="header-1__mega-column-heading">{{ col_heading | escape }}</p>
                          {%- endif -%}
                          {%- if col_menu != blank and linklists[col_menu].links.size > 0 -%}
                            <ul class="header-1__mega-column-links" role="none">
                              {%- for child in linklists[col_menu].links -%}
                                <li role="none">
                                  <a href="{{ child.url }}" class="header-1__mega-link" role="menuitem">{{ child.title | escape }}</a>
                                </li>
                              {%- endfor -%}
                            </ul>
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    {%- endfor -%}
                  </div>
                </div>
              {%- elsif link.links != empty -%}
                <div class="header-1__dropdown" id="header-1-dropdown-{{ section.id }}-{{ forloop.index }}" role="menu" aria-label="{{ link.title | escape }}">
                  {%- for child in link.links -%}
                    <a href="{{ child.url }}" class="header-1__dropdown-link" role="menuitem">{{ child.title | escape }}</a>
                  {%- endfor -%}
                </div>
              {%- endif -%}
            </div>
          {%- endfor -%}
        {%- endif -%}
      </nav>

      <div class="header-1__actions">
        <button type="button" class="header-1__cart cart-toggle group" aria-label="{{ 'sections.header.open_cart' | t | default: 'Open cart' }}">
          <span class="header-1__cart-icon">
            <svg class="header-1__cart-icon-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><path d="M3 6h18"></path><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
          </span>
          <span class="header-1__cart-badge cart-count" data-cart-count>{{ cart.item_count }}</span>
        </button>
        <button type="button" class="header-1__menu-toggle" aria-label="{{ 'sections.header.open_menu' | t | default: 'Open menu' }}" aria-expanded="false" aria-controls="header-1-mobile">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 12h16"/><path d="M4 18h16"/><path d="M4 6h16"/></svg>
        </button>
      </div>
    </div>
  </div>
</header>

{%- render 'header-1-mobile', menu: section.settings.menu -%}

<div class="cart-drawer-overlay"></div>
{%- render 'cart-drawer' -%}

{% schema %}
{
  "name": "Header 1 (Sacred Rebel)",
  "class": "section-header-1",
  "settings": [
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo / brand name",
      "default": "Sacred Rebel"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "header_scrolled_bg",
      "label": "Solid background on scroll",
      "default": true,
      "info": "When enabled, header gets a solid background after scrolling."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Header background",
      "info": "Leave unset for transparent (e.g. over hero)."
    },
    {
      "type": "color",
      "id": "background_color_scrolled",
      "label": "Header background (when scrolled)",
      "default": "#faf7f2"
    }
  ],
  "blocks": [
    {
      "type": "mega_menu",
      "name": "Mega menu",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "trigger_handle",
          "label": "Menu item handle",
          "info": "Handle of the nav link that opens this mega menu (e.g. shop, collections). Matches the link title in lowercase with dashes (e.g. 'Our Story' → our-story)."
        },
        {
          "type": "select",
          "id": "columns",
          "label": "Number of columns",
          "default": "2",
          "options": [
            { "value": "2", "label": "2" },
            { "value": "3", "label": "3" },
            { "value": "4", "label": "4" },
            { "value": "5", "label": "5" }
          ]
        },
        {
          "type": "header",
          "content": "Column 1"
        },
        { "type": "text", "id": "column_1_heading", "label": "Heading" },
        { "type": "link_list", "id": "column_1_menu", "label": "Menu" },
        { "type": "image_picker", "id": "column_1_image", "label": "Image (optional)" },
        {
          "type": "header",
          "content": "Column 2"
        },
        { "type": "text", "id": "column_2_heading", "label": "Heading" },
        { "type": "link_list", "id": "column_2_menu", "label": "Menu" },
        { "type": "image_picker", "id": "column_2_image", "label": "Image (optional)" },
        {
          "type": "header",
          "content": "Column 3"
        },
        { "type": "text", "id": "column_3_heading", "label": "Heading" },
        { "type": "link_list", "id": "column_3_menu", "label": "Menu" },
        { "type": "image_picker", "id": "column_3_image", "label": "Image (optional)" },
        {
          "type": "header",
          "content": "Column 4"
        },
        { "type": "text", "id": "column_4_heading", "label": "Heading" },
        { "type": "link_list", "id": "column_4_menu", "label": "Menu" },
        { "type": "image_picker", "id": "column_4_image", "label": "Image (optional)" },
        {
          "type": "header",
          "content": "Column 5"
        },
        { "type": "text", "id": "column_5_heading", "label": "Heading" },
        { "type": "link_list", "id": "column_5_menu", "label": "Menu" },
        { "type": "image_picker", "id": "column_5_image", "label": "Image (optional)" }
      ]
    }
  ]
}
{% endschema %}
