{% comment %}
  Size Guide section: size charts (heading + table) and How to Measure block.
  Section background: color or image. How to Measure box: configurable background.
{% endcomment %}

{%- assign bg_type = section.settings.background_type | default: 'color' -%}
{%- assign bg_color = section.settings.background_color | default: '#faf7f2' -%}
{%- assign bg_image = section.settings.background_image -%}
{%- assign how_to_bg = section.settings.how_to_measure_bg_color | default: '#EDE8E0' -%}
{%- if section.blocks.size > 0 -%}
<section
  class="size-guide-section"
  data-section-id="{{ section.id }}"
  style="
    {%- if bg_type == 'color' -%}
      background-color: {{ bg_color }};
    {%- elsif bg_type == 'image' and bg_image != blank -%}
      background-image: url({{ bg_image | image_url: width: 1920 }});
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    {%- else -%}
      background-color: {{ bg_color }};
    {%- endif -%}
  "
>
  {%- if bg_type == 'image' and bg_image != blank -%}
    <div class="size-guide-section__overlay" aria-hidden="true"></div>
  {%- endif -%}

  <div class="size-guide-section__inner">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'size_chart' -%}
          {%- assign heading = block.settings.heading | default: 'Size chart' -%}
          {%- assign header_labels = block.settings.header_labels | split: ',' -%}
          {%- assign rows_text = block.settings.rows_text | strip | replace: '\n', '<br />' | newline_to_br -%}
          {%- assign rows = rows_text | split: '<br />' -%}
          <div class="size-guide-section__chart" {{ block.shopify_attributes }}>
            <h2 class="size-guide-section__chart-title">{{ heading }}</h2>
            <div class="size-guide-section__table-wrap">
              <table class="size-guide-section__table">
                <thead>
                  <tr class="size-guide-section__thead-row">
                    {%- for label in header_labels -%}
                      <th class="size-guide-section__th">{{ label | strip }}</th>
                    {%- endfor -%}
                  </tr>
                </thead>
                <tbody>
                  {%- for row in rows -%}
                    {%- assign row = row | strip -%}
                    {%- if row != blank -%}
                      {%- assign cells = row | split: '|' -%}
                      <tr class="size-guide-section__tr">
                        {%- for cell in cells -%}
                          {%- assign cell_stripped = cell | strip -%}
                          {%- if forloop.first -%}
                            <td class="size-guide-section__td size-guide-section__td--size">{{ cell_stripped }}</td>
                          {%- else -%}
                            <td class="size-guide-section__td">{{ cell_stripped }}</td>
                          {%- endif -%}
                        {%- endfor -%}
                      </tr>
                    {%- endif -%}
                  {%- endfor -%}
                </tbody>
              </table>
            </div>
          </div>

        {%- when 'how_to_measure' -%}
          {%- assign how_heading = block.settings.heading | default: 'How to Measure' -%}
          {%- assign items_text = block.settings.items_text | strip | replace: '\n', '<br />' | newline_to_br -%}
          {%- assign items = items_text | split: '<br />' -%}
          <div class="size-guide-section__how-to" style="background-color: {{ how_to_bg }};" {{ block.shopify_attributes }}>
            <h2 class="size-guide-section__how-to-title">{{ how_heading }}</h2>
            <ul class="size-guide-section__how-to-list">
              {%- assign index = 0 -%}
              {%- for item in items -%}
                {%- assign item = item | strip -%}
                {%- if item != blank -%}
                  {%- assign index = index | plus: 1 -%}
                  <li class="size-guide-section__how-to-item">
                    <span class="size-guide-section__how-to-num">{{ index }}.</span>
                    {{ item }}
                  </li>
                {%- endif -%}
              {%- endfor -%}
            </ul>
          </div>
      {%- endcase -%}
    {%- endfor -%}
  </div>
</section>
{%- endif -%}

{% schema %}
{
  "name": "Size guide",
  "tag": "section",
  "class": "size-guide-section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Section background"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "Background type",
      "default": "color",
      "options": [
        { "value": "color", "label": "Color" },
        { "value": "image", "label": "Image" }
      ]
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#faf7f2"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image",
      "info": "Used when Background type is Image."
    },
    {
      "type": "color",
      "id": "how_to_measure_bg_color",
      "label": "How to Measure box background",
      "default": "#EDE8E0"
    }
  ],
  "blocks": [
    {
      "type": "size_chart",
      "name": "Size chart",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Chart heading",
          "default": "Tops, Hoodies & Outerwear"
        },
        {
          "type": "text",
          "id": "header_labels",
          "label": "Column headers",
          "default": "Size, Chest (in), Length (in), Sleeve (in)",
          "info": "Comma-separated (e.g. Size, Chest (in), Length (in), Sleeve (in))."
        },
        {
          "type": "textarea",
          "id": "rows_text",
          "label": "Table rows",
          "default": "XS|38-40|26|32\nS|40-42|27|33\nM|42-44|28|34\nL|44-46|29|35\nXL|46-48|30|36\n2XL|48-50|31|37",
          "info": "One row per line. Cells separated by | (e.g. XS|38-40|26|32)."
        }
      ]
    },
    {
      "type": "how_to_measure",
      "name": "How to Measure",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "How to Measure"
        },
        {
          "type": "textarea",
          "id": "items_text",
          "label": "List items",
          "default": "Measure yourself over undergarments\nUse a soft measuring tape\nFor chest: measure around the fullest part\nFor waist: measure at your natural waistline\nFor hip: measure around the fullest part of your hips\nWhen between sizes, size up for oversized fit, down for fitted",
          "info": "One instruction per line. Numbers are added automatically."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Size guide",
      "blocks": [
        {
          "type": "size_chart",
          "settings": {
            "heading": "Tops, Hoodies & Outerwear",
            "header_labels": "Size, Chest (in), Length (in), Sleeve (in)",
            "rows_text": "XS|38-40|26|32\nS|40-42|27|33\nM|42-44|28|34\nL|44-46|29|35\nXL|46-48|30|36\n2XL|48-50|31|37"
          }
        },
        {
          "type": "size_chart",
          "settings": {
            "heading": "Bottoms & Joggers",
            "header_labels": "Size, Waist (in), Hip (in), Inseam (in)",
            "rows_text": "XS|26-28|36-38|29\nS|28-30|38-40|29\nM|30-32|40-42|30\nL|32-34|42-44|30\nXL|34-36|44-46|31\n2XL|36-38|46-48|31"
          }
        },
        {
          "type": "how_to_measure"
        }
      ]
    }
  ]
}
{% endschema %}
