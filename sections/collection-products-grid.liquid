{% comment %}
  Collection products grid section. Used by collection.json.
  Renders header, nav (all collections), sort, product grid.
  Fetchable via ?sections=collection-grid for JS tab switching.
{% endcomment %}

{% schema %}
{
  "name": "Collection products grid",
  "tag": "section",
  "class": "shop-page-section",
  "settings": [],
  "presets": [
    { "name": "Collection products grid" }
  ]
}
{% endschema %}

<div id="shop-page-content" class="shop-page min-h-screen bg-[#FAF7F2]" data-collection-handle="{{ collection.handle }}" data-section-id="{{ section.id }}">
  <section class="shop-page__header pt-32 pb-12 px-6 lg:px-12">
    <div class="shop-page__header-inner max-w-7xl mx-auto">
      <span class="shop-page__label font-sans text-xs tracking-[0.3em] uppercase text-[#C4A77D] mb-4 block">The Collection</span>
      <h1 class="shop-page__title font-serif text-5xl md:text-6xl text-[#1A1A1A] mb-4">{{ collection.title | default: 'All Products' }}</h1>
      <p class="shop-page__count font-sans text-lg text-[#1A1A1A]/70">{{ collection.products_count }} {% if collection.products_count == 1 %}product{% else %}products{% endif %}</p>
    </div>
  </section>

  <section class="shop-page__products pb-24 px-6 lg:px-12">
    <div class="shop-page__products-inner max-w-7xl mx-auto">
      <div class="shop-page__toolbar flex flex-wrap items-center justify-between gap-4 mb-12 pb-6 border-b border-[#EDE8E0]">
        <nav class="shop-page__nav hidden md:flex items-center gap-6" aria-label="Collection categories">
          <a href="/collections/all" class="shop-page__nav-link font-sans text-sm transition-colors duration-300{% if collection.handle == 'all' %} text-[#1A1A1A] font-medium{% else %} text-[#1A1A1A]/60 hover:text-[#1A1A1A]{% endif %}">All Products</a>
          {%- if linklists['shop'] != blank -%}
            {%- for link in linklists['shop'].links -%}
              <a href="{{ link.url }}" class="shop-page__nav-link font-sans text-sm transition-colors duration-300{% if link.active %} text-[#1A1A1A] font-medium{% else %} text-[#1A1A1A]/60 hover:text-[#1A1A1A]{% endif %}">{{ link.title }}</a>
            {%- endfor -%}
          {%- elsif linklists['main-menu'] != blank -%}
            {%- for link in linklists['main-menu'].links -%}
              {%- if link.links != blank -%}
                {%- assign link_title_down = link.title | downcase -%}
                {%- if link_title_down == 'shop' or link_title_down == 'catalog' -%}
                  {%- for child in link.links -%}
                    <a href="{{ child.url }}" class="shop-page__nav-link font-sans text-sm transition-colors duration-300{% if child.active %} text-[#1A1A1A] font-medium{% else %} text-[#1A1A1A]/60 hover:text-[#1A1A1A]{% endif %}">{{ child.title }}</a>
                  {%- endfor -%}
                  {%- break -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        </nav>
        <button type="button" class="shop-page__filter-btn md:hidden flex items-center gap-2 font-sans text-sm text-[#1A1A1A]" aria-label="Filters">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shop-page__filter-icon w-4 h-4" aria-hidden="true"><path d="M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z"></path></svg>
          Filters
        </button>
        <div class="shop-page__sort">
          <label for="ShopSortBy" class="visually-hidden">Sort by</label>
          <select id="ShopSortBy" class="shop-page__sort-select font-sans text-sm bg-transparent border border-[#EDE8E0] px-4 py-2 focus:outline-none focus:border-[#C4A77D]" aria-label="Sort collection">
            <option value="manual">Featured</option>
            <option value="created-descending">Newest</option>
            <option value="price-ascending">Price: Low to High</option>
            <option value="price-descending">Price: High to Low</option>
          </select>
        </div>
      </div>

      {% paginate collection.products by 24 %}
        {% if collection.products.size > 0 %}
          <div class="shop-page__grid grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8">
            {% for product in collection.products %}
              {% render 'product-card-shop', product: product %}
            {% endfor %}
          </div>

          {% if paginate.pages > 1 %}
            <nav class="shop-page__pagination mt-12 flex justify-center items-center gap-4" aria-label="Collection pagination">
              {% if paginate.previous %}
                <a href="{{ paginate.previous.url }}" class="shop-page__pagination-link">Previous</a>
              {% endif %}
              <span class="shop-page__pagination-info text-sm text-[#1A1A1A]/60">Page {{ paginate.current_page }} of {{ paginate.pages }}</span>
              {% if paginate.next %}
                <a href="{{ paginate.next.url }}" class="shop-page__pagination-link">Next</a>
              {% endif %}
            </nav>
          {% endif %}
        {% else %}
          <p class="shop-page__empty text-[#1A1A1A]/60 text-center py-12">No products in this collection.</p>
        {% endif %}
      {% endpaginate %}
    </div>
  </section>
</div>

{{ 'collection-shop.js' | asset_url | script_tag }}
